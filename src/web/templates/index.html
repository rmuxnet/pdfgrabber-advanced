{% extends "layouts/base.html" %}

{% block header_left %}
<h1 class="text-lg font-semibold">Services</h1>
{% endblock %}

{% block content %}
<div x-data="servicesPage()" x-cloak>
    <div class="mb-8 animate-fade-up">
        <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-brand-600 via-brand-700 to-brand-900 p-8 lg:p-10">
            <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmYiIGZpbGwtb3BhY2l0eT0iMC4wNCI+PHBhdGggZD0iTTM2IDE0djJoLTJ2LTJoMnptMCAyMHYyaC0ydi0yaDJ6bS0yMCAwdjJIMTR2LTJoMnptMC0yMHYySDE0di0yaDJ6Ii8+PC9nPjwvZz48L3N2Zz4=')] opacity-50"></div>
            <div class="relative">
                <h2 class="text-2xl lg:text-3xl font-bold text-white mb-2">Welcome to PDFGrabber</h2>
                <p class="text-brand-200 max-w-xl">Select a service below to browse and download books from your library. All your credentials are stored locally.</p>
            </div>
            <div class="absolute -bottom-6 -right-6 w-32 h-32 rounded-full bg-white/5 blur-xl"></div>
            <div class="absolute -top-10 -right-16 w-48 h-48 rounded-full bg-white/5 blur-2xl"></div>
        </div>
    </div>

    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6 animate-fade-up-delay-1">
        <div class="relative w-full sm:w-80">
            <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
            <input x-model="search" type="text" placeholder="Search services..."
                   class="w-full pl-10 pr-4 py-2.5 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-500/40 focus:border-brand-500 transition-all duration-200">
        </div>
        <div class="flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
            <span class="flex items-center gap-1.5">
                <span class="inline-block w-2 h-2 rounded-full bg-brand-500"></span>
                <span x-text="filteredCount"></span> services available
            </span>
        </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 animate-fade-up-delay-2">
        {% for service, module in services.items() %}
        <a href="/library/{{ service }}"
           x-show="matchesSearch('{{ service }}', '{{ module }}')"
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100"
           class="group relative flex flex-col p-5 rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 hover:border-brand-300 dark:hover:border-brand-700 hover:shadow-lg hover:shadow-brand-500/5 transition-all duration-200 cursor-pointer">

            <div class="flex items-center justify-between mb-4">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-brand-100 to-brand-50 dark:from-brand-900/50 dark:to-brand-950/50 flex items-center justify-center ring-1 ring-brand-200/50 dark:ring-brand-800/50">
                    <span class="text-sm font-bold font-mono text-brand-600 dark:text-brand-400 uppercase">{{ service[:2] }}</span>
                </div>
                <svg class="w-5 h-5 text-gray-300 dark:text-gray-700 group-hover:text-brand-500 group-hover:translate-x-0.5 transition-all duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </div>

            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1 group-hover:text-brand-600 dark:group-hover:text-brand-400 transition-colors">{{ module }}</h3>
            <span class="text-xs font-mono text-gray-400 dark:text-gray-600">{{ service }}</span>

            <div class="absolute inset-x-0 bottom-0 h-0.5 rounded-b-2xl bg-gradient-to-r from-brand-500 to-brand-400 opacity-0 group-hover:opacity-100 transition-opacity duration-200"></div>
        </a>
        {% endfor %}
    </div>

    <template x-if="filteredCount === 0">
        <div class="flex flex-col items-center justify-center py-16 text-center">
            <div class="w-16 h-16 rounded-2xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </div>
            <p class="text-sm font-medium text-gray-500 dark:text-gray-400">No services match your search</p>
            <button @click="search = ''" class="mt-2 text-xs text-brand-600 dark:text-brand-400 hover:underline">Clear search</button>
        </div>
    </template>
</div>

<script>
function servicesPage() {
    const serviceNames = {{ services.keys()|list|tojson }};
    const serviceModules = {{ services.values()|list|tojson }};
    return {
        search: '',
        get filteredCount() {
            if (!this.search.trim()) return serviceNames.length;
            const q = this.search.toLowerCase();
            return serviceNames.filter((s, i) => s.toLowerCase().includes(q) || serviceModules[i].toLowerCase().includes(q)).length;
        },
        matchesSearch(code, name) {
            if (!this.search.trim()) return true;
            const q = this.search.toLowerCase();
            return code.toLowerCase().includes(q) || name.toLowerCase().includes(q);
        }
    }
}
</script>
{% endblock %}